<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>金英台招聘系统</title>
    <!-- BOOTSTRAP STYLES-->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONTAWESOME STYLES-->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
       <!--CUSTOM BASIC STYLES-->
    <link href="assets/css/basic.css" rel="stylesheet" />
    <!--CUSTOM MAIN STYLES-->
    <link href="assets/css/mycss.css" rel="stylesheet" />
    <link href="assets/img/title.png" rel="icon" type="image/x-icon" />
    <!-- GOOGLE FONTS-->
    <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' /> -->
    <style>
    	 *{margin:0;padding:0;}   
		 .parentCls{width:200px;}  
		 .auto-tip li{width:100%;height:22px;line-height:22px;font-size:14px;list-style-type:none; background:#FFF}  
		 .auto-tip li.hoverBg{background:#ddd;cursor:pointer;}  
		 .red{color:black;}  /*下拉框补充*/
		 .hidden {display:none;}
		 ul{margin-left:15px;}
        .modal_form_select_mul{height:120px!important;width:314px;outline: none !important;}
        .capslock {
		    position: absolute;
		    z-index: 4;
		    display: inline;
		    width: 116px;
		    top: 32px;
		    left: 96px;
		    padding-left: 10px;
		    height: 26px;
		    line-height: 28px;
		    overflow: hidden;
		    background: #F9F900;
		}
		/* #pwdSpan{margin:0 0.5em;font-size:85.7%;} */
		.topArrow{
			width:0px;
			height:0px;
			border:solid 10px;
			border-color:#ffffff  #ffffff #F9F900 #ffffff ;
			display:inline-block;
			position:absolute;
			right: 125px;
		    z-index: 4;
		    top: 12px;
		}   
    </style>
</head>
<body>
	<div>
     <nav class="navbar navbar-cls-top " role="navigation" style="margin-bottom: 0;background:white">
        <img alt="picture" src="assets/img/titlePic2.png" height="130">
     </nav>
     <nav class="navbar navbar-default navbar-cls-top " role="navigation" style="margin-bottom: 0">
     </nav>
        <!-- /. NAV TOP  -->
   </div>
    <div id="wrapper">
        <div id="page-wrapper">
            <div id="page-inner">
                <div class="row">
                <div class="col-md-2"></div>
                    <div class="col-md-12">
                        <h1><b></b></h1>
                    </div>
                </div>
                <!-- /. ROW  -->
               <div class="row">
                <div class="col-md-12">
                <form id="userRegisterForm">
                	<div class="row"></div>
                	<div class="col-md-2"></div>
                    <div class="panel panel-default col-md-6">
                        <div class="panel-body">
                            <div class="form-group row">
                            	<div class="col-md-12 row">
			                        <label><h1><b>忘记密码</b></h1></label>
			                        <hr />
			                    </div>
			                    <div class="col-md-12 row">
			                        <h1><b></b></h1>
			                    <div id="firstStep">
				                    <div class="form-group row" id="verify_email">
				                     <div class="col-md-3"style="display:inline-block;width:17.5%;padding-right:5px;text-align:right;">
				                        <label>邮箱</label>
				                     </div>
				                     <div class="col-md-8 parentCls" style="display:inline-block;width:66.7%;padding-right:5px">
				                        <input class="form-control inputElem" style="display:inline-block;" id="email" name="email" type="text" autocomplete="off"/>
				                     </div> 
				                     <div style="display:inline-block;width:8%;">       
				                        <button type="button"  class="btn btn-default" onclick="showCodeInput()">验证</button>
				                     </div>         
				                </div>
				                <div class="form-group row" id="verify_code"style="display:none">
			                        <div class="col-md-3" style="display:inline-block;width:17.5%;padding-right:5px;text-align:right;">
			                            <label>验证码</label>
			                        </div>
			                        <div class="col-md-8" style="display:inline-block;width:66.7%;padding-right:5px">
			                        	<input class="form-control" style="display:inline-block" id="code" name="code" type="text" />
			                        	<span class="flag_wrong" id="code_flag">x</span>
			                        </div>	                        
			                    </div>
		                    </div>
		                    <div id="nextStep"  style="display:none">
			                    <div class="form-group row">
			                        <div class="col-md-3" style="display:inline-block;width:17.5%;padding-right:5px;text-align:right;">
			                            <label>密码</label>
			                        </div>
			                        <div class="col-md-8"style="display:inline-block;width:66.7%;padding-right:5px;position:relative">
			                        	<input class="form-control" id="password" name="password" type="password" />
			                        	<div id="pwdSpan" style="display:none;">
				                           <div class="topArrow"></div>
				                           <span  class="capslock">大写锁定已打开</span>
			                           </div>
			                        </div>
			                    </div>
			                    <div class="form-group row">
			                        <div class="col-md-3" style="display:inline-block;width:17.5%;padding-right:5px;text-align:right;position:relative">
			                            <label>密码确认</label>
			                        </div>
			                        <div class="col-md-8"style="display:inline-block;width:66.7%;padding-right:5px">
			                        	<input class="form-control" id="password1" name="password1" type="password" />
			                        	<div id="pwdSpan1" style="display:none;">
				                           <div class="topArrow"></div>
				                           <span  class="capslock">大写锁定已打开</span>
			                            </div>
			                        </div>
			                    </div>	
		                    </div>	                    			                
		                    <hr />
		                    <div class="form-group row" style="text-align:center">
						        <!-- <div class="col-md-4"></div> -->
						        <button type="button" class="btn btn-info" id="nextStep_btn"onclick="nextStep()">下一步</button>
						        <button type="button" class="btn btn-primary" style="display:none;" id="setNewPassword_btn"onclick="setNewPassword()">确 定</button>
						        <button type="button" class="btn btn-danger" style="margin-left:10px;"onclick="goBack()">取 消</button>
				            </div>
		                    </div>
                        </div>
                       </div>
                      </div>
                    </form>
                </div>
            </div>
            </div>
            <!-- /. PAGE INNER  -->
        </div>
        <!-- /. PAGE WRAPPER  -->
    </div>
    <script src="assets/js/jquery-1.10.2.js"></script>
    <!-- BOOTSTRAP SCRIPTS -->
    <script src="assets/js/bootstrap.js"></script>
    <!-- METISMENU SCRIPTS -->

    <script src="assets/js/simpleUtil.js"></script>
    <script src="assets/js/ve1.js"></script>
	<script src="assets/js/veHelper.js"></script>
	<script src="assets/js/simpleUtil.js"></script>
	<script src="assets/js/myjs/supplement.js"></script>
	<script>
	    var verify_code = "";
	    function nextStep()
	    {
	    	 var code = document.getElementById("code").value;
	    	 var temp = document.getElementById("email");    //对电子邮件的验证
	         var inputValue = temp.value;
			 var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
			 if(inputValue==""){
	             alert("请填入邮箱");
	             temp.focus();
	             return;
	         }else if(!myreg.test(temp.value))
			 {
		        alert("请输入有效的E_mail！");
		        temp.focus();
	            return false;
             }
	    	if(document.getElementById("verify_code").style.display=="none")
    		{
	    		alert("请完成验证！");
    		    return;
    		}
	    	if(code=="")
    		{
    		    alert("请填入验证码！");
    		    document.getElementById("code").focus();
    		}else if(verify_code!=code)
    			{
    			   alert("验证码不正确！");
    			   document.getElementById("code").focus();
    			}else
    				{
    				 $("#nextStep").css("display","block");
    				 $("#firstStep").css("display","none");
    				 $("#nextStep_btn").css("display","none");
    				 $("#setNewPassword_btn").css("display","inline-block");
    				}
    }
	    
		function setNewPassword(){		
		   var password = document.getElementById("password").value;
		   var password1 = document.getElementById("password1").value;
		   if(password=="")
		   {
		       alert("请填写密码");
		       return;
		   }		   
			var flag_pwd = 0;
			var chineseWord = 0;
			var numReg = /^[0-9]+$/;
			var charReg = /^[a-z]+$/;
			var bCharReg = /^[A-Z]+$/;
			var chineseReg  =/[^\u0000-\u00FF]/;
			for (var i = 0; i < password.length; i++) { 
				if(chineseReg.test(password.substr(i, 1))){
					chineseWord +=1;
					break;
				}
			} 
			if(chineseWord==1){
			    alert("密码不能包含中文");
			    return;
			}
			var specialReg  =/[`~!@#$%^&*_+<>{}\/'[\]]/m;
			for (var i = 0; i < password.length; i++) { 
				if(numReg.test(password.substr(i, 1))){
					flag_pwd +=1;
					break;
				}
			} 
			for (var i = 0; i < password.length; i++) { 
				if(charReg.test(password.substr(i, 1))){
					flag_pwd +=1;
					break;
				}
			} 
			
			for (var i = 0; i < password.length; i++) { 
				if(bCharReg.test(password.substr(i, 1))){
					flag_pwd +=1;
					break;
				}
			} 
			
			for (var i = 0; i < password.length; i++) { 
				if(specialReg.test(password.substr(i, 1))){
					flag_pwd +=1;
					break;
				}
			} 
			if(password.length>20||password.length<6||flag_pwd<2)
			{
			   alert("密码长度限于6至20之间，且密码至少由大小写、数字和特殊字符中的2种组成！");
			   return;
			}
		   if(password1=="")
		   {
		       alert("请确认密码");
		       return;
		   }
		   if(password!=password1)
		   {
			   alert("两次密码输入不一致！");
		       return;
		   }		  
		  cVe.startReqByMsgHandle(cVeName,'','','reqSetNewPassword','resSetNewPassword','ECP.handle.UserHandle.handleMsg');			
		}
		
		function reqSetNewPassword(){
			var req = {};
			req["user_type"] = "机构";
			req["op"] = "findPassword";
			req["newEmail"] = document.getElementById("email").value;
			req["password"] = document.getElementById("password").value;
			cVe.setConn(cServerUri,"POST", true, JSON.stringify(req));
		}
		
		function resSetNewPassword(){
			var retData =cVe.XHR.responseText;
			var retDataObj=JSON.parse(retData);
			var result=retDataObj[cVe.cEioVeDataId];
			if(result.result=="0"){
				alert("密码修改成功，友情提示：您的账号为 "+result.user_id);
				window.location.href="login.jsp";
			}else{
				alert(result.msg);
				document.getElementById("code").value = "";
				document.getElementById("password").value = "";
				document.getElementById("password1").value = "";
				$("#nextStep_btn").css("display","inline_block");
				 $("#setNewPassword_btn").css("display","none");
				$("#nextStep").css("display","none");
				$("#firstStep").css("display","block");
				$("#verify_code").css("display","none");
				var btn = document.getElementById("email"); 
				btn.focus();
				//window.location.href="userRegisterPage.jsp";
				//$("#chooseUid").modal('show');
			}
		}
	
		function goBack(){
			window.location.href="login.jsp";
		}
		
		function showCodeInput(){		         
		         var temp = document.getElementById("email");    //对电子邮件的验证
		         var inputValue = temp.value;
				 var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
				 if(inputValue==""){
		             alert("请填入邮箱");
		             return;
		         }else if(!myreg.test(temp.value))
				 {
			        alert("请输入有效的E_mail！");
			        temp.focus();
		            return false;
	             }else{
		             verifyBeforeRegiste();  
		         }
		}
		
		function verifyBeforeRegiste(){	
		         cVe.startReqByMsgHandle(cVeName,'','','reqVerifyBeforeRegiste','resVerifyBeforeRegiste','ECP.handle.common.CCommonHandle.handleMsg');
		}
		
		function reqVerifyBeforeRegiste(){
		    var req = {};
		    req["op"] = "email_verify";
		    req["email"] = document.getElementById("email").value;
		    cVe.setConn(cServerUri,"POST", true, JSON.stringify(req));
		}
		
		function resVerifyBeforeRegiste(){
			var retData =cVe.XHR.responseText;
			var retDataObj=JSON.parse(retData);
			var result=retDataObj[cVe.cEioVeDataId];
			if(result.result=="success"){
				verify_code = result.identify_check;
				alert("已将验证码发送至您的邮箱，请将验证码填入相应位置。");
				document.getElementById("code").value = "";
		        $("#verify_code").css("display","block"); 
			}else{
				alert("验证失败，请确认邮箱是否输入正确！");
			}
		}
		document.onkeydown=function(event) { 
			/*var pathName = window.location.pathname;
			var len = pathName.split("/").length; */
			var hasFocus = $("#password").is(':focus');//当前光标是否处于密码输入框内
			var hasFocus1 = $("#password1").is(':focus');
			if(event.keyCode==20&&hasFocus&&document.getElementById("pwdSpan").style.display=="inline")
			{
				document.getElementById("pwdSpan").style.display="none";
			}else if(event.keyCode==20&&hasFocus1&&document.getElementById("pwdSpan1").style.display=="inline")
			{
				document.getElementById("pwdSpan1").style.display="none";
			}
		};
		$("#password").blur(function()
				{
					document.getElementById("pwdSpan").style.display="none";
				});
		$("#password1").blur(function()
				{
					document.getElementById("pwdSpan1").style.display="none";
				});
		function  detectCapsLock(event){
		    var e = event||window.event;
		    //var o = e.target||e.srcElement;
		    var oTip = document.getElementById("pwdSpan");
		    var oTip1 = document.getElementById("pwdSpan1");
		    var hasFocus = $("#password").is(':focus');//当前光标是否处于密码输入框内
			var hasFocus1 = $("#password1").is(':focus');
		    var keyCode  =  e.keyCode||e.which; // 按键的keyCode 
		    var isShift  =  e.shiftKey ||(keyCode  ==   16 ) || false ; // shift键是否按住
		     if (
		     ((keyCode >=   65   &&  keyCode  <=   90 )  &&   !isShift) // Caps Lock 打开，且没有按住shift键 
		     || ((keyCode >=   97   &&  keyCode  <=   122 )  &&  isShift)// Caps Lock 打开，且按住shift键
		     ){
		    	 if(hasFocus)
		    		 {
		    		 	oTip.style.display = 'inline';
		    		 }else if(hasFocus1){
		    			 oTip1.style.display = 'inline';
		    		 }
		      }else{
		    	  if(hasFocus)
		    		 {
		    		 	oTip.style.display = 'none';
		    		 }else if(hasFocus1){
		    			 oTip1.style.display = 'none';
		    		 }
		    	  } 
		}
		document.getElementById('password').onkeypress = detectCapsLock;
		document.getElementById('password1').onkeypress = detectCapsLock;
	</script>
</body>
</html>

	